# @package __global__
# Music Multiple - Enhanced MAGNeT Configuration for 44.1kHz
# MAGNeT model optimized for multiple genre music generation

defaults:
  - musicgen/default
  - /model: lm/music_multiple_lm
  - override /dset: audio/multigenre_44khz
  - _self_

lm_model: transformer_lm_magnet
solver: magnet

autocast: true
autocast_dtype: bfloat16

# EnCodec enhanced for music multiple
compression_model_checkpoint: //pretrained/music_multiple/encodec_44khz

efficient_attention_backend: xformers

channels: 2  # Stereo for music
sample_rate: 44100  # CD quality

deadlock:
  use: true

dataset:
  batch_size: 144  # Adjusted for stereo
  sample_on_weight: true  # Weighted sampling for genre balance
  sample_on_duration: false
  segment_duration: 15  # Longer segments for musical context

optim:
  epochs: 600  # Extended training for genre mastery
  optimizer: dadam
  lr: 0.8  # Adjusted learning rate
  ema:
    use: true
    updates: 15
    device: cuda

logging:
  log_tensorboard: true
  log_audio_samples: true

schedule:
  lr_scheduler: cosine
  cosine:
    warmup: 6000
    lr_min_ratio: 0.05
    cycle_length: 1.0

codebooks_pattern:
  modeling: parallel
  parallel:
    empty_initial: -1
  
transformer_lm:
  card: 2048
  causal: false
  subcodes_context: 8  # Enhanced context for musical complexity
  compression_model_framerate: 86  # Higher framerate for better temporal resolution
  segment_duration: 0
  span_len: -1

masking:
  span_len: 4  # Longer spans for musical phrases

generate:
  lm: 
    max_prompt_len: null
    max_gen_len: null
    remove_prompts: false
    use_sampling: true
    temp: 2.5  # Lower temperature for more coherent music
    top_k: 50
    top_p: 0.95
    max_cfg_coef: 15.0
    min_cfg_coef: 1.5
    decoding_steps: [80, 20, 15, 10]  # More steps for higher quality
    anneal_temp: true
    span_scoring: 'max'
    span_arrangement: 'nonoverlap'
    cfg_coef_genre: 2.0  # Genre-specific guidance
    cfg_coef_style: 1.5  # Style-specific guidance
    prompted_samples: false
    samples:
      prompted: false
      unprompted: true

# Music Multiple: Enhanced MAGNeT configuration
music_multiple:
  model_type: "magnet_enhanced"
  sample_rate: 44100
  channels: 2
  application: "multi_genre_music_generation"
  
  magnet_enhancements:
    extended_context: true
    longer_spans: true
    enhanced_sampling: true
    genre_aware_generation: true
    
  genre_adaptability:
    latin: "excellent"
    electronic: "excellent"
    rock: "excellent"
    pop: "excellent"
    jazz: "very_good"
    classical: "good"
    
  generation_quality:
    musical_coherence: "high"
    structural_integrity: "high"
    genre_accuracy: "high"
    audio_quality: "high"
    
  use_cases:
    professional_music_production: true
    creative_ai_tools: true
    music_education: true